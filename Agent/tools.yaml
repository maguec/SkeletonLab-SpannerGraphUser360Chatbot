sources:
  spanner-graph:
    database: ${GOOGLE_SPANNER_DB}
    instance: ${GOOGLE_SPANNER_INSTANCE}
    kind: spanner
    project: ${GOOGLE_CLOUD_PROJECT}

tools:
  lookup_account_by_email:
    description: Find the account number for a given email address
    kind: spanner-sql
    parameters:
    - description: Email address
      name: email
      type: string
    source: spanner-graph
    statement: SELECT id AS AccountId, email, sus as IS_SUSPECT from Email as e where e.email = @email;

  lookup_account_by_phonenumber:
    description: Find the account number for a given phone number
    kind: spanner-sql
    parameters:
    - description: Phone Number
      name: phone
      type: string
    source: spanner-graph
    statement: >
      GRAPH UserIdentity
      MATCH (d:Device{phone: @phone})<-[:HAS_DEVICE]-(e:Email)
      RETURN e.id as UserId, e.sus as IS_SUSPECT

  lookup_creditcard_by_userid:
    description: Giventhe user id which is a UUID show all associated credit cards
    kind: spanner-sql
    parameters:
    - description: User Id
      name: user_id
      type: string
    source: spanner-graph
    statement: >
      GRAPH UserIdentity
      MATCH (e:Email{id: @user_id})-[:EMAIL_HAS_CC]->(cc:CC)
      RETURN e.id as ID, cc.last4 AS CC_LAST4, cc.zip AS CC_ZIP, cc.sus AS IS_SUSPECT, cc.id as CC_ID LIMIT 10;

  lookup_orders_by_userid:
    description: Given the user id which is a UUID display all of their shipping addresses
    kind: spanner-sql
    parameters:
    - description: User Id
      name: user_id
      type: string
    source: spanner-graph
    statement: >
      GRAPH UserIdentity
      MATCH (e:Email{id: @user_id})<-[:HAS_EMAIL]-(s:SalesOrder)-[:HAS_ADDRESS]->(a:ShippingAddress)
      RETURN a.address AS ShippingAddress, s.id AS ORDER_ID, s.sus as ORDER_SUSPECT, a.sus AS ShippingAddress_SUSPECT

toolsets:
  customerservice:
    - lookup_account_by_email
    - lookup_account_by_phonenumber
    - lookup_orders_by_userid
    - lookup_creditcard_by_userid
